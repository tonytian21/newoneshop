<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>{wc:fun:lang::get_lang('购物车')} - {wc:fun:_cfg("web_name")}</title>
<meta name="keywords" content="{wc:if isset($keywords)}{wc:$keywords}{wc:else}{wc:fun:_cfg("web_key")}{wc:if:end}" />
<meta name="description" content="{wc:if isset($description)}{wc:$description}{wc:else}{wc:fun:_cfg("web_des")}{wc:if:end}" />
<!-- <link rel="stylesheet" type="text/css" href="{G_TEMPLATES_STYLE}/css/comm.css"/>
<link rel="stylesheet" type="text/css" href="{G_TEMPLATES_STYLE}/css/CartList.css"/> -->
<link rel="stylesheet" type="text/css" href="{G_TEMPLATES_CSS}/index.css"/>
<link rel="stylesheet" type="text/css" href="{G_TEMPLATES_STYLE}/css/mycart.css">
<link rel="stylesheet" type="text/css" href="{G_TEMPLATES_STYLE}/css/comm.css">
<script type="text/javascript" src="{G_GLOBAL_STYLE}/global/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="{G_TEMPLATES_JS}/jquery.cookie.js"></script>
</head>
<body>
<div class="logo">
	<div class="float">
		<span class="logo_pic"><a href="{G_WEB_PATH}" class="a" title="{wc:fun:_cfg("web_name")}">
			<img src="{G_UPLOAD_PATH}/{wc:fun:Getlogo()}"/>
		</a></span>
		<span class="tel"><a href="{G_WEB_PATH}" style="color:#999;">{wc:fun:lang::get_lang('返回首页')}</a></span>
	</div>
</div>
<div class="shop_process">
	<ul class="process">
		<li class="first_step">{wc:fun:lang::get_lang('第一步')}:{wc:fun:lang::get_lang('提交订单')}</li>
		<li class="arrow_1"></li>
		<li class="secend_step">{wc:fun:lang::get_lang('第二步')}:{wc:fun:lang::get_lang('订单支付')}</li>
		<li class="arrow_2"></li>
		<li class="third_step">{wc:fun:lang::get_lang('第三步')}:{wc:fun:lang::get_lang('支付成功等待揭晓')}</li>
		<li class="arrow_2"></li>
		<li class="fourth_step">{wc:fun:lang::get_lang('第四步')}:{wc:fun:lang::get_lang('揭晓获得者')}</li>
	</ul>
	<div class="i_tips"></div>
	<div class="submitted">
		<ul class="order">
			<li class="top">
				<span class="goods">{wc:fun:lang::get_lang('商品')}</span>
				<span class="name">{wc:fun:lang::get_lang('名称')}</span>
				<span class="moneys">{wc:fun:lang::get_lang('价值')}</span>
				<span class="money">{wc:fun:lang::get_lang('单价')}</span>
				<span class="num">{wc:fun:lang::get_lang('人次')}</span>
				<span class="xj">{wc:fun:lang::get_lang('小计')}</span>
				<span class="do">{wc:fun:lang::get_lang('操作')}</span>
			</li>
			{wc:loop $shoplist $shops}            
			<li class="end" id="shoplist{wc:$shops['id']}">
				<span class="goods">
					<a href="{WEB_PATH}/goods/{wc:$shops['id']}">
                   	 <img src="{wc:fun:lang::get_image(G_UPLOAD_PATH.'/'.$shops['thumb'])}" />
                    </a>                    
				</span>
				<span class="name">
					<a href="{WEB_PATH}/go/index/item/{wc:$shops['id']}" >{wc:if $this->_cfg['route_l'] == 'en-us'}{wc:$shops['titleen']}{wc:else}{wc:$shops['title']}{wc:if:end}</a>
					<p>{wc:fun:lang::get_lang('总需')} <span class="color">{wc:$shops['zongrenshu']}</span>{wc:fun:lang::get_lang('人次参与')},{wc:fun:lang::get_lang('还剩')} 
                      	   <span class="gorenci">{wc:$shops['cart_shenyu']}</span> {wc:fun:lang::get_lang('人次')}
                    </p>
				</span>
				<span class="moneys">{wc:$shops['money']}{wc:fun:lang::get_lang('1Shop币')}</span>
				<span class="money"><span class="color"><b>{wc:$shops['yunjiage']}{wc:fun:lang::get_lang('1Shop币')}</b></span></span>
				<span class="num">
				<a href="JavaScript:;" val="{wc:$shops['id']}" class="jia">+</a>				
					<dl class="add">					
					<dd><input type="type" val="{wc:$shops['id']}" onkeyup="value=value.replace(/\D/g,'')" value="{wc:$shops['cart_gorenci']}" class="amount" /></dd>
						                      
					</dl>
					<a href="JavaScript:;" val="{wc:$shops['id']}" class="jian">-</a>
                    <p class="message"></p>
                    			 <a href="javascript:;" class="shop_last_all" val="{wc:$shops['id']}">{wc:fun:lang::get_lang('购买全部')}</a>  
				</span>
				<span  class="xj">{wc:$shops['cart_xiaoji']}</span>
				<span class="do"><a href="javascript:;" onclick="delcart({wc:$shops['id']})"  class="delgood">{wc:fun:lang::get_lang('删除')}</a></span> 
			</li>		
			{wc:loop:end}
			<li class="ts">
				<p class="right">{wc:fun:lang::get_lang('总计')}:<span id="moenyCount"  style="color: #f60;">{wc:$MoenyCount}</span>{wc:fun:lang::get_lang('1Shop币')}</p>
			</li>
		</ul>
	</div>
	<h5>
		<a href="{WEB_PATH}" id="but_on">{wc:fun:lang::get_lang('返回继续夺宝')}</a>
		<input id="but_ok" type="button" value="{wc:fun:lang::get_lang('去结算')}"  name="submit"/>
	</h5>
</div>  
<script type="text/javascript"> 
var info={wc:$Cartshopinfo};
var numberadd=$(".jia");

var numbersub=$(".jian");
var shoplast=$(".shop_last_all");
var xiaoji=$(".xj");
var num=$(".amount");
var message=$(".message");
var moenyCount=$("#moenyCount");
var cookie_pre="wc_";
$(function(){
	$("#but_ok").click(function(){
		var countmoney=parseInt(moenyCount.text());		
		if(countmoney > 0){		
			$.cookie(cookie_pre+'Cartlist',$.toJSON(info),{expires:7,path:'/'});
			$.cookie('Cartlist',$.toJSON(info),{expires:30,path:'/'});
			document.location.href='{WEB_PATH}/member/cart/pay';
		}else{
			alert("{wc:fun:lang::get_lang('购物车为空')}!");
		}
	});
});
function UpdataMoney(shopid,number,zindex){		
		var number = parseInt(number);
		info['MoenyCount']=info['MoenyCount']-info[shopid]['money']*info[shopid]['num']+info[shopid]['money']*number;
		info[shopid]['num']=number;
		var xjmoney=xiaoji.eq(zindex+1);
			xjmoney.text(info[shopid]['money']*number+'.00');
			moenyCount.text(info['MoenyCount']+'.00');
}


function delcart(id){
	info['MoenyCount'] = info['MoenyCount']-info[id]['money']*info[id]['num'];
	$("#shoplist"+id).hide();
	$("#moenyCount").text(info['MoenyCount']+".00");
	delete info[id];
	
	$.cookie('Cartlist',$.toJSON(info),{expires:30,path:'/'});
}

shoplast.click(function(){
	var shopid=$(this).attr('val');		
	var zindex=shoplast.index(this);
	var thisnum=num.eq(zindex);	
		thisnum.val(info[shopid]['shenyu']);
		UpdataMoney(shopid,thisnum.val(),zindex);	
});

num.keyup(function(){
	var shopid=$(this).attr("val");
	var zindex=num.index(this);	
	if($(this).val() > info[shopid]['shenyu']){
		message.eq(zindex).text("{wc:fun:lang::get_lang('1Shop次数不能超过')}"+info[shopid]['shenyu']+"{wc:fun:lang::get_lang('次')}");		
		$(this).val(info[shopid]['shenyu']);
		UpdataMoney(shopid,$(this).val(),zindex);		
		return;
	}
	if($(this).val()<1){
		message.eq(zindex).text("{wc:fun:lang::get_lang('1Shop次数不能少于1次')}");
		$(this).val(1);
		UpdataMoney(shopid,$(this).val(),zindex);
		return;
	}	
	UpdataMoney(shopid,$(this).val(),zindex);	
});
numberadd.click(function(){

	var shopid=$(this).attr('val');		
	var zindex=numberadd.index(this);
	var thisnum=num.eq(zindex);	
		if(info[shopid]['num'] >= info[shopid]['shenyu']){
			message.eq(zindex).text("{wc:fun:lang::get_lang('夺宝次数不能超过')}"+info[shopid]['shenyu']+"{wc:fun:lang::get_lang('次')}");
			return;
		}
		var number=info[shopid]['num']+1;			
			thisnum.val(number);
			UpdataMoney(shopid,number,zindex);
});
numbersub.click(function(){
	var shopid=$(this).attr('val');		
	var zindex=numbersub.index(this);
	var thisnum=num.eq(zindex);	
		if(info[shopid]['num'] <=1){
			message.eq(zindex).text("{wc:fun:lang::get_lang('夺宝次数不能少于1次')}");
			return;
		}
		var number=info[shopid]['num']-1;			
			thisnum.val(number);
			UpdataMoney(shopid,number,zindex);
});

</script> 

{wc:templates "index","footer"}